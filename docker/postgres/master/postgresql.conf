# PostgreSQL Configuration File for Master

# Connection Settings
listen_addresses = '*'
port = 5432
max_connections = 100

# Memory Settings (Настройки памяти)
shared_buffers = 128MB          # Общая память для кэширования данных
effective_cache_size = 512MB    # Ожидаемый размер кэша ОС (для планировщика)
maintenance_work_mem = 64MB     # Память для операций обслуживания (VACUUM, CREATE INDEX)
work_mem = 4MB                  # Память для сортировки и хеш-таблиц на операцию

# WAL Settings (Настройки Write-Ahead Log для репликации)
wal_level = replica             # Уровень логирования WAL (replica = достаточно для репликации)
max_wal_senders = 3             # Максимум процессов для отправки WAL репликам
wal_keep_size = 128MB           # Сколько WAL файлов хранить для реплик
hot_standby = on                # Разрешить чтение на реплике во время репликации

# Logging
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d.log'
log_statement = 'all'
log_connections = on
log_disconnections = on

# Performance (Производительность)
checkpoint_completion_target = 0.9  # Растянуть checkpoint на 90% времени
wal_buffers = 16MB              # Буфер для WAL в памяти
default_statistics_target = 100  # Детальность статистики для планировщика
random_page_cost = 1.1           # Стоимость случайного чтения страницы
effective_io_concurrency = 200   # Ожидаемое количество одновременных I/O операций